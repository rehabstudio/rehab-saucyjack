<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/saucy-jack.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">src/</a> saucy-jack.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>75/75</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">98% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>49/50</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>15/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>48/48</span>
      </div>
      <div class='fl pad1y'>
        <span class="strong">2 statements, 4 branches</span>
        <span class="quiet">Ignored</span>  &nbsp;&nbsp;&nbsp;&nbsp;
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">40×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">27×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">export class SaucyJack {
    constructor(options = {}) {
&nbsp;
        /**
         * @property {object} DEBUG -  Show the scroll line on the screen.
         * @property {object} TRIGGER_LINE_POS - Percentile Y co-ordinate (from 0 to 1) where the imaginary trigger line is in the viewport. Entities get 'triggered' when their top edge hits this line.
         * @property {object} ENTITY_SELECTOR - A selector that we will grab on init to set up the list of elements to watch
         * @property {object} ACTIVE_CLASS - The class we give any watched element when it goes over the trigger line.
         * @property {object} INVERT_BEHAVIOUR - If true, the class is removed instead of added when it crosses the line, and vice versa.  Good for 'release'-style transitions-in.
         */
        const defaults = {
            DEBUG: false,
            TRIGGER_LINE_POS: 0.85,
            ENTITY_SELECTOR: '.saucy-el',
            ACTIVE_CLASS: 'saucy-active',
            INVERT_BEHAVIOUR: false,
        }
        
        // Checking if the passed 'options' param is an object. If its not then set it to the defaults.
        if(options instanceof Object || !options instanceof Array) {
          
            options.DEBUG =  options.DEBUG ? options.DEBUG : defaults.DEBUG;
            options.TRIGGER_LINE_POS = options.TRIGGER_LINE_POS ? options.TRIGGER_LINE_POS : defaults.TRIGGER_LINE_POS;
            options.ENTITY_SELECTOR = options.ENTITY_SELECTOR ? options.ENTITY_SELECTOR : defaults.ENTITY_SELECTOR;
            options.ACTIVE_CLASS = options.ACTIVE_CLASS ? options.ACTIVE_CLASS : defaults.ACTIVE_CLASS;
            options.INVERT_BEHAVIOUR = options.INVERT_BEHAVIOUR ? options.INVERT_BEHAVIOUR : defaults.INVERT_BEHAVIOUR;
        }else{
            options = defaults;
        }
&nbsp;
        this.options = options;
&nbsp;
        this._entities = [];
        this._triggerLinePixelPos = 0;
        this._scrollPos = 0;
        this._debugEl = null;
&nbsp;
&nbsp;
        var els = document.querySelectorAll(this.options.ENTITY_SELECTOR);
        for(var i = 0, ln = els.length; i &lt; ln; i++) {
            this.addElement(els[i]);
        }
&nbsp;
        this._getScrollPos();
        this._updateTriggerLine();
        this._updateEntities();
        
        if(this.options.DEBUG) {
            this._debugEl = document.createElement('div');
            this._debugEl.classList.add('saucy-debug');
            document.body.appendChild(this._debugEl);
            this._updateDebugEl();
        }
        
        window.addEventListener('resize', this._onResize.bind(this), false);
        window.addEventListener('scroll', this._onScroll.bind(this), false);
    }
&nbsp;
    // Get the top edge positions of the entities on the page.
    // NICETOHAVE: allow for triggering from the center or bottom edge of the el,
    // not just from the top.
    _updateEntities() {
        this._entities.forEach(function(ent) {
            ent.yTop = ent.el.getBoundingClientRect().top;
            
            // TODO: check if element is 'in range' and ignore if it isn't
            
            var isActive = (this._triggerLinePixelPos &gt; ent.yTop);
            this._setActiveStatus(ent, isActive);
        }.bind(this));
    }
    
    // Update the current scroll position (the top of the viewport).
    _getScrollPos() {
        this._scrollPos = window.scrollY || ((window.pageYOffset || document.body.scrollTop) - (document.body.clientTop || 0));
    }
&nbsp;
    // Work out the actual pixel position of the 'trigger line' based on the viewport
    // size and the trigger percentage.
    _updateTriggerLine() {
        this._triggerLinePixelPos = Math.round((window.innerHeight || <span class="branch-1 cbranch-no" title="branch not covered" >d</span>ocument.documentElement.clientHeight) * this.options.TRIGGER_LINE_POS);
    }
    
    // Add or remove the active attribute and class for the entity.
    _setActiveStatus(ent, isActive) {
        if (!(typeof isActive === 'boolean')) {
            isActive = true;
        }
        if(ent.active === isActive) {
            return;
        }
&nbsp;
        ent.active = isActive;
        var fn = (isActive &amp;&amp; !this.options.INVERT_BEHAVIOUR) ? 'add' : 'remove';
        ent.el.classList[fn](this.options.ACTIVE_CLASS);
    }
    
    // Callback for the resize event. Re-calcs the positions of our entities.
    // NICETOHAVE: debounce
    _onResize() {
        this._updateTriggerLine();
        this._updateEntities();
        if (this.options.DEBUG) this._updateDebugEl();
    }
    
    // Callback for the resize event. Iterates the entities and add/removes the 'active'
    // status if they've gone over the trigger line.
    _onScroll() {
        this._getScrollPos();
        this._updateEntities();
        if (this.options.DEBUG) this._updateDebugEl();
    }
    
    // Updates the debug el.
    _updateDebugEl() {
        this._debugEl.style.top = this._triggerLinePixelPos + 'px';
    }
    
    // Add a wrapper object for an element to our 'watch list' for later use.
    // NICETOHAVE: de-duplicate
    addElement(el) {
        var elObj = {
            el: el,
            yTop: 0,
            active: false
        };
        this._entities.push(elObj);    
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Mar 09 2016 17:41:32 GMT+0000 (GMT)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
